#!/bin/sh
# speclib - Make a special version of the cygwin import library.
#
#   Copyright 2001, 2002 Red Hat, Inc.
#
# This file is part of Cygwin.
#
# This software is a copyrighted work licensed under the terms of the
# Cygwin license.  Please consult the file "CYGWIN_LICENSE" for
# details.

case "$1" in
    -v) v="-v"; shift
esac
lib=$1; shift
nm=$1; shift
dlltool=$1; shift
as=$1; shift
def=$1; shift
trap "rm -f /tmp/$$.def" 0 1 2 15
(echo "LIBRARY cygwin1.dll
EXPORTS"; $nm --extern-only --defined-only $* | sed -e '/^[ 	]*$/d' -e '/:$/d' -e 's/^.* _\(.*\)/\1/' |  grep $v -f - -w $def |egrep -vi '^library|exports|^$' | sort) > /tmp/$$.def
$dlltool --as=$as -d /tmp/$$.def -l "$lib"
