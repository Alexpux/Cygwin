2008-02-03  Brian Dessent  <brian@dessent.net>

	* smallprint.cc (__small_vsprintf): Use HEAP_NOTHEAP for type.
	* strfuncs.cc (sys_wcstombs_alloc): Guard use of ccalloc
	to !__OUTSIDE_CYGWIN__ for use in cygserver.
	(sys_mbstowcs_alloc): Ditto.

2008-02-01  Corinna Vinschen  <corinna@vinschen.de>

	* miscfuncs.cc (cygwin_wcsncasecmp): Never access more than n
	characters.
	(cygwin_strncasecmp): Ditto.  Fix for strings longer than n.

2008-02-01  Corinna Vinschen  <corinna@vinschen.de>

	* string.h: Re-enable inline strcasematch and strncasematch
	implementations and rename to ascii_strcasematch/ascii_strncasematch.
	* dcrt0.cc: Replace str[n]casematch with ascii_str[n]casematch where
	applicable.
	* environ.cc: Ditto.
	* fhandler_process.cc: Ditto.
	* hookapi.cc: Ditto.
	* path.cc: Ditto.
	* spawn.cc: Ditto.
	* strace.cc: Ditto.
	* syscalls.cc: Ditto.
	* uinfo.cc: Ditto.
	* winf.cc: Ditto.

2008-01-31  Corinna Vinschen  <corinna@vinschen.de>

	* dcrt0.cc (dll_crt0_1): Use GetCommandLineW and convert to current
	codepage.
	* environ.cc (set_file_api_mode): Always set file api to ANSI if not
	using the OEM codepage.
	(codepage_init): Allow "utf8" codepage.
	* fhandler_clipboard.cc (set_clipboard): Convert clipbuf to void and
	cast as needed.  Always convert input to wide char and write
	CF_UNICODETEXT to clipboard.
	(fhandler_dev_clipboard::read): Read CF_UNICODETEXT from clipboard and
	convert to current codepage if CYGWIN_NATIVE format is not available.
	* fhandler_console.cc: Drop redundant undef.
	* smallprint.cc (__small_vsprintf): Convert PWCHAR and UNICODE_STRING
	to current codepage for printing.
	* strfuncs.cc: Use PWCHAR throughout.
	(get_cp): Return CP_UTF8 for utf8_cp codepage setting.
	(sys_wcstombs): Allow NULL target buffer.
	(sys_wcstombs_alloc): New function.
	(sys_mbstowcs_alloc): Ditto.
	* winsup.h (codepage_type): Add utf8_cp.
	(HEAP_NOTHEAP): Define.
	(sys_wcstombs_alloc): Declare.
	(sys_mbstowcs_alloc): Declare.

2008-01-31  Corinna Vinschen  <corinna@vinschen.de>

	* cygheap.h (struct cwdstuff): Add dir member to store cwd handle.
	(cwdstuff::get_handle): New method.
	* path.cc (cwdstuff::set): When doit is true, always try to get
	directory handle.  Fail if duplicating handle fails.  Store handle
	in dir.  Fix potential SEGV when setting drive_length. 

2008-01-28  Corinna Vinschen  <corinna@vinschen.de>

	* path.cc: Fix Samba version in comment.

2008-01-24  Corinna Vinschen  <corinna@vinschen.de>

	* path.cc (fs_info::update): Fix old-style Samba test to support
	recent as well as upcoming Samba releases.

2008-01-22  Corinna Vinschen  <corinna@vinschen.de>

	* ntdll.h (struct _FILE_FS_OBJECTID_INFORMATION): Define.
	* path.cc (struct smb_extended_info): Define.
	(fs_info::update): Request object id info to get Samba information.
	Set flags according to new implementation.
	* path.h (struct fs_info): Add samba_version to status_flags.
	Implement flags() and samba_version() using IMPLEMENT_STATUS_FLAG.

2008-01-21  Corinna Vinschen  <corinna@vinschen.de>

	* fhandler_disk_file.cc (fhandler_disk_file::link): Open file with
	READ_CONTROL for Vista/Longhorn's sake.

2008-01-15  Corinna Vinschen  <corinna@vinschen.de>

	* Makefile.in (install-libs): Overwrite newlib's libg.a with symlink
	to libcygwin.a.

2008-01-15  Corinna Vinschen  <corinna@vinschen.de>

	* Makefile.in (DLL_OFILES): Remove memmem.o.
	* memmem.cc: Remove in favor of newlib implementation.

2008-01-07  Corinna Vinschen  <corinna@vinschen.de>

	* fhandler.h: Update copyright.
	* include/limits.h: Ditto.

2008-01-06  Christopher Faylor  <me+cygwin@cgf.cx>

	* fhandler.h (fhandler_base::is_tty): Make bool.
	(fhandler_serial::is_tty): Ditto.
	(fhandler_termios::is_tty): Ditto.
	(fhandler_base::is_slow): Return bool value.
	(fhandler_socket::is_slow): Ditto.
	(fhandler_serial::is_slow): Ditto.
	(fhandler_console::is_slow): Ditto.
	(fhandler_tty_common::is_slow): Ditto.
	(fhandler_tty_master::is_slow): Ditto.
	(fhandler_dev_null::is_slow): Ditto.

2008-01-06  Christopher Faylor  <me+cygwin@cgf.cx>

	* include/limits.h (TTY_NAME_MAX): Increase size to same as linux to
	allow for (at least) null terminating byte for "/dev/console".

2008-01-01  Christopher Faylor  <me+cygwin@cgf.cx>

	* tty.cc: Update copyright.
	* pipe.cc: Ditto.

2008-01-01  Christopher Faylor  <me+cygwin@cgf.cx>

	* newsym: First stab at understanding data as well as functions.

	* pipe.cc (fhandler_pipe::init): Move more intelligence here.
	(fhandler_pipe::create): Simplify based on above change.

	* tty.cc (tty_list::allocate): Remove non-NT code.

